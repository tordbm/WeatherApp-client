import{j as I,k as tt,l as W,p as j,n as q,o as V,q as P,r as et,u as U,t as at,b as st,F as ot,_ as rt,i as nt,v as it,w as dt,d as ct}from"./ErrorToast.vue_vue_type_script_setup_true_lang-d45e1863.js";import{d as m,_,o as i,c as h,g as x,t as c,F as b,i as S,a,r as y,p as D,j as k,w as L,q as lt,s as ht,C as z,x as R,y as F,B as ut,L as pt,z as yt,A as ft,D as mt,E as _t,G as Dt,H,I as wt,J as G,K as bt,b as gt,v as vt,M as Ct,e as O,f as $t}from"./index-b61450f6.js";const kt=m({emits:["accordion-click"],props:{weatherData:{type:Object,required:!0}},mounted(){this.initTooltip()},methods:{formatDayInfo(t){return screen.width>=1024?I(t.datetime):tt(t.datetime)},toggleAccordion(t){this.$emit("accordion-click",t)},initTooltip:W("tooltip"),formatDate:I,parseConditions:j,parseConditionsToText:q,showPrecip:V}});const xt=["id"],Tt={class:"accordion-item"},At=["id"],Lt=["onClick","data-bs-target","aria-expanded","aria-controls"],Ot={class:"icon-right"},St={class:"degree-right"},Pt=["id","aria-labelledby","data-bs-parent"],Mt={class:"accordion-body"},Nt={class:"table table-hover mt-2"},Bt=["title"];function Et(t,e,o,l,s,r){return i(),h(b,null,[x(c(t.weatherData.description)+" ",1),(i(!0),h(b,null,S(t.weatherData.days,(n,d)=>(i(),h("div",{key:d,class:"accordion",id:"accordionDays"+d},[a("div",Tt,[a("h2",{class:"accordion-header",id:"heading"+d},[a("button",{onClick:p=>t.toggleAccordion(d),class:"accordion-button collapsed",type:"button","data-bs-toggle":"collapse","data-bs-target":"#collapse"+d,"aria-expanded":d===0,"aria-controls":"collapse"+d},[x(c(d===0?"Today":t.formatDayInfo(n))+" ",1),a("div",Ot,c(t.parseConditions(n.icon)),1),a("div",St,c(Math.round(n.tempmax))+" º",1)],8,Lt)],8,At),a("div",{id:"collapse"+d,class:"accordion-collapse collapse","aria-labelledby":"heading"+d,"data-bs-parent":"#accordionDays"+d},[a("div",Mt,[a("table",Nt,[a("tbody",null,[(i(!0),h(b,null,S(n.hours,p=>(i(),h("tr",{key:p.datetime},[a("td",null,c(p.datetime.slice(0,5)),1),a("td",null,[a("h4",{ref_for:!0,ref:"tooltip",title:t.parseConditionsToText(p.icon)},c(t.parseConditions(p.icon)),9,Bt)]),a("td",null,c(Math.round(p.temp))+" º",1),a("td",null,c(t.showPrecip(p.precip)),1),a("td",null,c(Math.round(p.windspeed/3.6))+" m/s",1)]))),128))])])])],8,Pt)])],8,xt))),128))],64)}const Ft=_(kt,[["render",Et]]),Ht=m({props:{weatherData:{type:Object,required:!0}},data(){return{todayData:this.weatherData.days[0]}},mounted(){this.initTooltip()},methods:{initTooltip:W("tooltip"),filterNextHours:P,parseConditions:j,parseConditionsToText:q,showPrecip:V}}),It={class:"table table-hover mt-2"},Wt=["title"];function jt(t,e,o,l,s,r){return i(),h(b,null,[x(c(t.todayData.description)+" ",1),a("table",It,[a("tbody",null,[(i(!0),h(b,null,S(t.filterNextHours(t.todayData,t.weatherData),n=>(i(),h("tr",null,[a("td",null,c(n.datetime.slice(0,5)),1),a("td",null,[a("h4",{ref_for:!0,ref:"tooltip",title:t.parseConditionsToText(n.icon)},c(t.parseConditions(n.icon)),9,Wt)]),a("td",null,c(Math.round(n.temp))+" º",1),a("td",null,c(t.showPrecip(n.precip)),1),a("td",null,c(Math.round(n.windspeed/3.6))+" m/s",1)]))),256))])])],64)}const qt=_(Ht,[["render",jt]]),Vt=m({props:{weatherData:{type:Object,required:!0}},methods:{formatDateTime:et}}),Ut={class:"alert alert-warning alert-dismissible fade show",role:"alert"},zt={class:"alert-heading"},Rt=a("hr",null,null,-1),Gt={class:"mb-0"},Kt=a("button",{type:"button",class:"btn-close","data-bs-dismiss":"alert","aria-label":"Close"},null,-1);function Jt(t,e,o,l,s,r){return i(),h("div",Ut,[a("h4",zt,c(t.weatherData.alerts[0].event),1),a("p",null,c(t.weatherData.alerts[0].description),1),Rt,a("p",Gt,[x(" Valid from "),a("b",null,c(t.formatDateTime(t.weatherData.alerts[0].onset)),1),x(" to "),a("b",null,c(t.formatDateTime(t.weatherData.alerts[0].ends)),1)]),Kt])}const Zt=_(Vt,[["render",Jt]]),Qt=m({emits:["accordion-click"],components:{WeatherData15Day:Ft,WeatherDataToday:qt,Alerts:Zt},props:{weatherData:{type:Object,required:!0}},data(){return{today:!0}},methods:{handleAccordionClick(t){this.$emit("accordion-click",t)}}});const M=t=>(lt("data-v-1480d728"),t=t(),ht(),t),Xt={class:"row align-items-center"},Yt={class:"col-md"},te={class:"col-md-auto"},ee={class:"nav justify-content-end"},ae={key:0},se=M(()=>a("label",{class:"btn",for:"Today"},"Today",-1)),oe={key:1},re=M(()=>a("label",{class:"btn",for:"Today"},"Today",-1)),ne={key:2},ie=M(()=>a("label",{class:"btn",for:"15Day"},"15 Day",-1)),de={key:3},ce=M(()=>a("label",{class:"btn",for:"15Day"},"15 Day",-1));function le(t,e,o,l,s,r){const n=y("Alerts"),d=y("WeatherDataToday"),p=y("WeatherData15Day");return i(),h(b,null,[a("div",Xt,[t.weatherData.alerts.length>0?(i(),D(n,{key:0,"weather-data":t.weatherData},null,8,["weather-data"])):k("",!0),a("div",Yt,[a("h2",null,c(t.weatherData.address),1)]),a("div",te,[a("nav",ee,[t.today?(i(),h("div",ae,[a("input",{type:"radio",class:"btn-check",id:"Today",onClick:e[0]||(e[0]=L(u=>{t.today=!0,t.handleAccordionClick(0)},["prevent"])),checked:""}),se])):(i(),h("div",oe,[a("input",{type:"radio",class:"btn-check",id:"Today",onClick:e[1]||(e[1]=L(u=>{t.today=!0,t.handleAccordionClick(0)},["prevent"]))}),re])),t.today?(i(),h("div",de,[a("input",{type:"radio",class:"btn-check",id:"15Day",onClick:e[3]||(e[3]=L(u=>t.today=!1,["prevent"]))}),ce])):(i(),h("div",ne,[a("input",{type:"radio",class:"btn-check",id:"15Day",onClick:e[2]||(e[2]=L(u=>t.today=!1,["prevent"])),checked:""}),ie]))])])]),a("h5",null,c(t.weatherData.resolvedAddress),1),t.today?(i(),D(d,{key:0,"weather-data":t.weatherData},null,8,["weather-data"])):(i(),D(p,{key:1,"weather-data":t.weatherData,onAccordionClick:t.handleAccordionClick},null,8,["weather-data","onAccordionClick"]))],64)}const he=_(Qt,[["render",le],["__scopeId","data-v-1480d728"]]),K={data:{type:Object,required:!0},options:{type:Object,default:()=>({})},plugins:{type:Array,default:()=>[]},datasetIdKey:{type:String,default:"label"},updateMode:{type:String,default:void 0}},ue={ariaLabel:{type:String},ariaDescribedby:{type:String}},pe={type:{type:String,required:!0},destroyDelay:{type:Number,default:0},...K,...ue},ye=yt[0]==="2"?(t,e)=>Object.assign(t,{attrs:e}):(t,e)=>Object.assign(t,e);function $(t){return G(t)?H(t):t}function fe(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t;return G(e)?new Proxy(t,{}):t}function me(t,e){const o=t.options;o&&e&&Object.assign(o,e)}function J(t,e){t.labels=e}function Z(t,e,o){const l=[];t.datasets=e.map(s=>{const r=t.datasets.find(n=>n[o]===s[o]);return!r||!s.data||l.includes(r)?{...s}:(l.push(r),Object.assign(r,s),r)})}function _e(t,e){const o={labels:[],datasets:[]};return J(o,t.labels),Z(o,t.datasets,e),o}const De=m({props:pe,setup(t,e){let{expose:o,slots:l}=e;const s=ft(null),r=R(null);o({chart:r});const n=()=>{if(!s.value)return;const{type:u,data:g,options:v,plugins:f,datasetIdKey:N}=t,T=_e(g,N),w=fe(T,g);r.value=new z(s.value,{type:u,data:w,options:{...v},plugins:f})},d=()=>{const u=H(r.value);u&&(t.destroyDelay>0?setTimeout(()=>{u.destroy(),r.value=null},t.destroyDelay):(u.destroy(),r.value=null))},p=u=>{u.update(t.updateMode)};return mt(n),_t(d),Dt([()=>t.options,()=>t.data],(u,g)=>{let[v,f]=u,[N,T]=g;const w=H(r.value);if(!w)return;let A=!1;if(v){const C=$(v),B=$(N);C&&C!==B&&(me(w,C),A=!0)}if(f){const C=$(f.labels),B=$(T.labels),E=$(f.datasets),Y=$(T.datasets);C!==B&&(J(w.config.data,C),A=!0),E&&E!==Y&&(Z(w.config.data,E,t.datasetIdKey),A=!0)}A&&wt(()=>{p(w)})},{deep:!0}),()=>F("canvas",{role:"img",ariaLabel:t.ariaLabel,ariaDescribedby:t.ariaDescribedby,ref:s},[F("p",{},[l.default?l.default():""])])}});function Q(t,e){return z.register(e),m({props:K,setup(o,l){let{expose:s}=l;const r=R(null),n=d=>{r.value=d==null?void 0:d.chart};return s({chart:r}),()=>F(De,ye({ref:n},{type:t,...o}))}})}const we=Q("bar",ut),X=Q("line",pt),be=m({components:{Bar:we},props:{weatherData:{type:Object,required:!0},index:{type:Number,default:0}},computed:{chartData(){return{labels:this.labels,datasets:[{label:"Precipitation in mm",data:this.precipData,backgroundColor:"DeepSkyBlue",borderColor:"DeepSkyBlue"}]}},chartOptions(){return{responsive:!0,interaction:{intersect:!1},scales:{x:{grid:{display:!1}},y:{suggestedMax:5,grid:{display:!0}}}}},todayData(){return this.weatherData.days[this.index]},labels(){let t=[];return this.index>0?(this.todayData.hours.forEach(e=>{t.push(e.datetime.slice(0,5))}),t):(this.filterNextHours(this.todayData,this.weatherData).forEach(e=>{t.push(e.datetime.slice(0,5))}),t)},precipData(){let t=[];return this.index>0?(this.todayData.hours.forEach(e=>{t.push(parseFloat(e.precip.toFixed(1)))}),t):(this.filterNextHours(this.todayData,this.weatherData).forEach(e=>{t.push(parseFloat(e.precip.toFixed(1)))}),t)}},methods:{filterNextHours:P}});function ge(t,e,o,l,s,r){const n=y("Bar");return i(),D(n,{data:t.chartData,options:t.chartOptions},null,8,["data","options"])}const ve=_(be,[["render",ge]]),Ce=m({components:{Line:X},props:{weatherData:{type:Object,required:!0},index:{type:Number,default:0}},computed:{chartData(){return{labels:this.labels,datasets:[{label:"Temperature in °C",data:this.tempData,backgroundColor:"orange",borderColor:"orange",tension:.4,pointRadius:0}]}},chartOptions(){return{scales:{x:{grid:{display:!1}},y:{grace:"100%",grid:{display:!0}}},responsive:!0,interaction:{intersect:!1}}},todayData(){return this.weatherData.days[this.index]},labels(){let t=[];return this.index>0?(this.todayData.hours.forEach(e=>{t.push(e.datetime.slice(0,5))}),t):(this.filterNextHours(this.todayData,this.weatherData).forEach(e=>{t.push(e.datetime.slice(0,5))}),t)},tempData(){let t=[];return this.index>0?(this.todayData.hours.forEach(e=>{t.push(Math.round(e.temp))}),t):(this.filterNextHours(this.todayData,this.weatherData).forEach(e=>{t.push(Math.round(e.temp))}),t)}},methods:{filterNextHours:P}});function $e(t,e,o,l,s,r){const n=y("Line");return i(),D(n,{data:t.chartData,options:t.chartOptions},null,8,["data","options"])}const ke=_(Ce,[["render",$e]]),xe=m({components:{Line:X},props:{weatherData:{type:Object,required:!0},index:{type:Number,default:0}},computed:{chartData(){return{labels:this.labels,datasets:[{label:"Windspeed in m/s",data:this.windSpeedData,backgroundColor:"DeepPink",borderColor:"DeepPink",tension:.4,pointRadius:0},{label:"Windgusts in m/s",data:this.windGustsData,backgroundColor:"gray",borderColor:"gray",tension:.4,pointRadius:0}]}},chartOptions(){return{scales:{x:{grid:{display:!1}},y:{beginAtZero:!0,grace:"100%",grid:{display:!0}}},responsive:!0,interaction:{intersect:!1}}},todayData(){return this.weatherData.days[this.index]},labels(){let t=[];return this.index>0?(this.todayData.hours.forEach(e=>{t.push(e.datetime.slice(0,5))}),t):(this.filterNextHours(this.todayData,this.weatherData).forEach(e=>{t.push(e.datetime.slice(0,5))}),t)},windSpeedData(){let t=[];return this.index>0?(this.todayData.hours.forEach(e=>{t.push(Math.round(e.windspeed/3.6))}),t):(this.filterNextHours(this.todayData,this.weatherData).forEach(e=>{t.push(Math.round(e.windspeed/3.6))}),t)},windGustsData(){let t=[];return this.index>0?(this.todayData.hours.forEach(e=>{t.push(Math.round(e.windgust/3.6))}),t):(this.filterNextHours(this.todayData,this.weatherData).forEach(e=>{t.push(Math.round(e.windgust/3.6))}),t)}},methods:{filterNextHours:P}});function Te(t,e,o,l,s,r){const n=y("Line");return i(),D(n,{data:t.chartData,options:t.chartOptions},null,8,["data","options"])}const Ae=_(xe,[["render",Te]]),Le=m({setup(){const{alertsList:t}=U();return{alertsList:t}},data(){return{selectedCity:"",favoredCities:[]}},async mounted(){try{const t=at("accesstoken"),e=await st.get(`${ot}/users/me/cities/`,{headers:{Authorization:`Bearer ${t}`}});this.favoredCities=e.data}catch(t){this.alertsList.push(t.message)}},methods:{onSelectedCity(t){this.selectedCity=t,this.$emit("selectedCity",this.selectedCity)}}}),Oe={key:0,class:"dropdown"},Se=a("button",{class:"btn dropdown-toggle",type:"button",title:"Favorite cities","data-bs-toggle":"dropdown","aria-expanded":"false"},[a("svg",{xmlns:"http://www.w3.org/2000/svg",height:"20",width:"22.5",viewBox:"0 0 576 512"},[a("path",{fill:"#FFD43B",d:`M316.9 18C311.6 7 300.4 0 288.1 0s-23.4 7-28.8 18L195 150.3 51.4 171.5c-12 1.8-22 10.2-25.7 21.7s-.7 24.2 7.9
          32.7L137.8 329 113.2 474.7c-2 12 3 24.2 12.9 31.3s23 8 33.8 2.3l128.3-68.5 128.3 68.5c10.8 5.7 23.9 4.9
          33.8-2.3s14.9-19.3 12.9-31.3L438.5 329 542.7 225.9c8.6-8.5 11.7-21.2 7.9-32.7s-13.7-19.9-25.7-21.7L381.2 150.3 316.9 18z`})])],-1),Pe={class:"dropdown-menu"},Me=["onClick"];function Ne(t,e,o,l,s,r){return t.favoredCities.length>0?(i(),h("div",Oe,[Se,a("ul",Pe,[(i(!0),h(b,null,S(t.favoredCities,n=>(i(),h("li",null,[a("a",{class:"dropdown-item",href:"#",onClick:d=>t.onSelectedCity(n.city)},c(n.city),9,Me)]))),256))])])):k("",!0)}const Be=_(Le,[["render",Ne]]),Ee={components:{ContentLoader:rt,WeatherOverview:he,FavoriteCityDropdown:Be,ErrorToast:nt,PrecipChart:ve,TempChart:ke,WindChart:Ae},setup(){const{alertsList:t}=U();return{alertsList:t}},data(){return{weatherData:null,loading:!1,city:localStorage.city,lastFetchedCity:localStorage.city,clickedAccordionIndex:0}},computed:{...bt(ct,["currentUser"])},mounted(){this.fetchData()},methods:{getLocation(){this.loading=!0;const t=o=>{const l=o.coords.latitude,s=o.coords.longitude;this.getCityNameFromCoordinates(l,s)},e=o=>{this.alertsList.push(o.message),this.loading=!1};navigator.geolocation.getCurrentPosition(t,e,{timeout:1e4,maximumAge:3e4})},async getCityNameFromCoordinates(t,e){try{const l=await(await fetch(it(t,e))).json();this.city=l.address.city||l.address.town,this.fetchData()}catch(o){this.alertsList.push(o.message),console.error(o)}},async fetchData(){if(!(this.city==null||this.city===""))try{[this.loading,this.lastFetchedCity]=[!0,this.city],localStorage.city=this.city;const e=await(await fetch(dt(this.city))).json();this.weatherData=e,this.clickedAccordionIndex=0}catch(t){console.error(t),this.alertsList.push(t.message)}finally{this.loading=!1}},handleAccordionClick(t){if(typeof t=="number")this.clickedAccordionIndex=t;else{const e="Invalid index:"+t;console.error(e),this.alertsList.push(e)}},setCity(t){this.city=t,this.fetchData()}}},Fe={class:"row align-items-md-stretch"},He={class:"col-md-6 mb-3"},Ie={class:"col-md-8 mb-3"},We={class:"input-group mb-3"},je=["disabled"],qe=["disabled"],Ve=a("svg",{class:"pa-0 ma-0",width:"20",height:"20",fill:"#d40000",viewBox:"0 0 512 512",xmlns:"http://www.w3.org/2000/svg"},[a("path",{d:`M256 0c17.7 0 32 14.3 32 32V66.7C368.4 80.1 431.9 143.6 445.3 224H480c17.7 0 32 14.3 32 32s-14.3 32-32 32H445.3C431.9 368.4 368.4 431.9 288 445.3V480c0 17.7-14.3
            32-32 32s-32-14.3-32-32V445.3C143.6 431.9 80.1 368.4 66.7 288H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H66.7C80.1 143.6 143.6 80.1 224 66.7V32c0-17.7 14.3-32 32-32zM128 256a128 128 0 1 0 256 0 128 128 0 1 0 -256 0zm128-80a80 80 0 1 1 0 160 80 80 0 1 1 0-160z`})],-1),Ue=[Ve],ze={key:0,class:"col-md-6 mb-4"},Re={class:"p-5"},Ge={class:"p-5"},Ke={class:"p-5"};function Je(t,e,o,l,s,r){const n=y("FavoriteCityDropdown"),d=y("WeatherOverview"),p=y("TempChart"),u=y("PrecipChart"),g=y("WindChart"),v=y("ContentLoader");return i(),h("div",Fe,[a("div",He,[a("div",Ie,[a("div",We,[gt(a("input",{"onUpdate:modelValue":e[0]||(e[0]=f=>s.city=f),type:"input",placeholder:"Enter a city to see its weather!",id:"inputCity",class:"form-control form-control-lg",onKeyup:e[1]||(e[1]=Ct((...f)=>r.fetchData&&r.fetchData(...f),["enter"])),disabled:s.loading},null,40,je),[[vt,s.city]]),a("button",{type:"button",class:"btn btn-no-outline",onClick:e[2]||(e[2]=(...f)=>r.getLocation&&r.getLocation(...f)),disabled:s.loading},Ue,8,qe),t.currentUser?(i(),D(n,{key:0,class:"mt-1",onSelectedCity:r.setCity},null,8,["onSelectedCity"])):k("",!0)])]),s.weatherData&&!s.loading?(i(),D(d,{key:0,"weather-data":s.weatherData,onAccordionClick:r.handleAccordionClick},null,8,["weather-data","onAccordionClick"])):k("",!0)]),O(v,{loading:s.loading},{default:$t(()=>[s.weatherData&&!s.loading?(i(),h("div",ze,[a("div",Re,[O(p,{"weather-data":s.weatherData,index:s.clickedAccordionIndex},null,8,["weather-data","index"])]),a("div",Ge,[O(u,{"weather-data":s.weatherData,index:s.clickedAccordionIndex},null,8,["weather-data","index"])]),a("div",Ke,[O(g,{"weather-data":s.weatherData,index:s.clickedAccordionIndex},null,8,["weather-data","index"])])])):k("",!0)]),_:1},8,["loading"])])}const Xe=_(Ee,[["render",Je]]);export{Xe as default};
